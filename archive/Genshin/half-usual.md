# 原神 多次抽卡得到的频率是否平常

> 写于 221021

## 背景

原神抽妮露池民间收集的数据为：35485名玩家抽卡，有50.48%的玩家歪了小保底之后才抽到了妮露。（备注：歪小保底的概率为0.5）

我在和室友讨论，这件事情平常吗？

因为一般来说，如果样本量很大，频率趋向于概率。考虑伯努利的和，当N趋于无穷，概率分布则为高斯分布，我们可以采用标准正态分布来考虑，这时就会认为如果频率不在0.5附近，那就非常不合理。

但是这种想法在离散的时候行不通。固然可以用什么 $1 \sigma$ $2 \sigma$ $3 \sigma$ 来考虑，但是感觉不形象。

## 问题抽象

抛硬币正面反面朝上的概率均为1。计算 $n$ 次抛硬币的情况下，频率落在 $0.5±\Delta$ 的概率。

**理论解答**（未区分奇偶）：

$$
\frac{2 \times \sum_{i=0}^{n\cdot \Delta}C_{n}^{\frac{n}{2}-i}}{2^n}
$$

## Python计算

`Python` 的整形 `int` 默认高精度，所以我们可以直接计算而不采用近似的方式：

```py
from math import comb

n = 35485
delta = 0.0018

if n % 2 == 0:
    i_start = n // 2 + 1
else:
    i_start = (n + 1) // 2
i_end = int(n/2 + n*delta)
sum = 0
for i in range(i_start, i_end):
    sum += comb(n, i) # Python支持高精度
sum *= 2 # 1/2左右对称
if n % 2 == 0:
    sum += comb(n // 2)

fenzi = str(int(sum)); print(len(fenzi)) # 10683
fenmu = str(2 ** n); print(len(fenmu)) # 10683
# 由于整数已经达到了10^10683的量级，所以我们取前JINGDU位做小数除法，相当于是10^18也即60位整形，但之后做除法应该是浮点数除法
JINGDU = 18
fenzi_jinsi = int(fenzi[0:(JINGDU - (len(fenmu) - len(fenzi)))]) # 注意整数位数对齐
fenmu_jinsi = int(fenmu[0:JINGDU])
result = fenzi_jinsi / fenmu_jinsi 

print(f"抛{n}次硬币，频率在±{delta}内的概率为{result}。")
print(f"抛{n}次硬币，频率偏离{delta}的概率为{1-result}。")
```

```py
# 抛35485次硬币，频率在±0.0012内的概率为0.34434430719753695。
# 抛35485次硬币，频率偏离0.0012的概率为0.655655692802463。
# 抛35485次硬币，频率在±0.0018内的概率为0.49642734815256456。+++
# 抛35485次硬币，频率偏离0.0018的概率为0.5035726518474355。+++
# 抛35485次硬币，频率在±0.0024内的概率为0.6275209947339291。
# 抛35485次硬币，频率偏离0.0024的概率为0.3724790052660709。
# 抛35485次硬币，频率在±0.0036内的概率为0.8224636510737859。
# 抛35485次硬币，频率偏离0.0036的概率为0.17753634892621406。
# 抛35485次硬币，频率在±0.0048内的概率为0.9272356918798982。++
# 抛35485次硬币，频率偏离0.0048的概率为0.07276430812010182。++
# 抛35485次硬币，频率在±0.006内的概率为0.9756053037466393。
# 抛35485次硬币，频率偏离0.006的概率为0.02439469625336066。
```

## 思考

回到问题本身：什么叫「平常」？

- 是0.0048这个值以外出现的概率很小（7%），就可以认为这件事情不平常？
- 还是说0.0048附近的概率求和（出现在0.0036到0.0060之间的概率为15.32%）值小就说明不常见？
- 还是说在概率为50%（0.0018）以外的值都不常见？+++

感觉最后一种说法应该是比较符合直觉的。接下来用最后的一种思路直接计算出置信区间：

## 根据样本量计算置信区间

求概率在一半对应的左右区间百分比：

```py
from math import comb

n = 35485

threshold = 2 ** (n - 2) # 2^n*0.25（由于关于1/2对称，只考虑一半）
sum = 0
if n % 2 == 0:
    sum += comb(n, n // 2) // 2 # 偶数则需要将正中间的书按照一半计算
if n % 2 == 0:
    i_start = n // 2 + 1
else:
    i_start = (n + 1) // 2
for i in range(i_start, n):
    sum += comb(n, i) # Python支持高精度
    if sum > threshold:
        result = (i - n // 2) / n
        result_percentage = round(result*100, 4)
        print(f"样本量为{n}的情况下，频率落在50%±{result_percentage}%内的概率为0.5。")
        break
```

```py
# 样本量为20的情况下，频率落在50%±10.0%内的概率为0.5。
# 样本量为40的情况下，频率落在50%±5.0%内的概率为0.5。
# 样本量为100的情况下，频率落在50%±3.0%内的概率为0.5。
# 样本量为1000的情况下，频率落在50%±1.1%内的概率为0.5。
# 样本量为10000的情况下，频率落在50%±0.34%内的概率为0.5。
# 样本量为20000的情况下，频率落在50%±0.24%内的概率为0.5。
# 样本量为30000的情况下，频率落在50%±0.1933%内的概率为0.5。
# 样本量为35485的情况下，频率落在50%±0.1804%内的概率为0.5。
```

也就是说，如果样本有20个，频率出现在40%～60%之间还是挺正常的；如果样本有10000个，频率一旦小于49.66%或者大于50.34%就已经不太可能出现了，因为此时样本量已经很大了，频率应该和概率尽可能接近。

回到最初的问题：35485名玩家抽卡，有50.48%的玩家歪了小保底之后才抽到了妮露。这里统计得到的频率50.48%超过了50.18%，所以并不是一件常见的事情。

## 延伸思考

也许用方差来考虑会更好一些？还是说通过写出高斯分布，最终会得到相同的结论呢？另外平常不平常的衡量可以用0.0-1.0之间的一个小数来描述吗？这种描述是线性的吗？符合人们的直觉吗？这些都是可以考虑的问题。
