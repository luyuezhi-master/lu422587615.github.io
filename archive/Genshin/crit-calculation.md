# 原神 暴击暴伤配比计算与应用说明

> 作者：[杨希杰](https://github.com/Yang-Xijie) 
> 
> 时间：2021.12.12

## 太长不看版

* 在给一个角色的暴击暴伤资源总和一定的情况下，角色面板的暴击和暴伤配比为1:2时，双暴的伤害加成取得最大值（该结论可以经过简单而严格的数学论证得出）。
* 在圣遗物提供的双暴一定时，带暴击暴伤武器比不带的伤害高了约25%，推荐佩戴暴击暴伤武器提高伤害。
* 圣遗物的每一个双暴词条都能带来稳定的增幅，所以后期将重心放在有双暴词条圣遗物上是十分正确的。

## 前提

### 重视暴击暴伤的原因

首先为什么要**重视暴击暴伤**？因为在游戏后期攻击等其他加成同等幅度的提升对总伤害的加成并不多，因为暴击暴伤成为了后期玩家更重视的属性。如果只考虑单次暴击伤害，确实暴伤堆高可以形成大数字伤害；但只要攻击次数在两次以上，且不考虑重开，那么暴击暴伤按照下文的分析能达到最大化。

### 暴击暴伤的获取方式

其次我们要明白**暴击暴伤从何而来**？
* 角色初始暴击为5%，初始暴伤50%
* 五星圣遗物头冠位置的主属性满级可以提供31.1%暴击或62.2%暴伤，圣遗物副词条初始如果有四词条且含有暴击和暴伤、在后期5次强化过程中都加点在双暴上，可以得到2.7%/3.1%/3.5%/3.9%暴击或5.4%/6.2%/7.0%/7.8%暴伤
* 90级武器副属性可能给角色提供44.1%/33.1%/22.1%暴击或66.2%/44.1%暴伤，在武器的词条中可能也会增加暴击暴伤
* 角色的技能/天赋可能会增加暴击暴伤（暂不考虑）

### 暴击暴伤价值

从圣遗物、武器的暴击暴伤配比来看，可以发现同等资源暴伤的数值是暴击的两倍；也就是说，同等资源下，暴击的价值是暴伤的两倍。因此我们可以使用一种简单的方式来计算暴击暴伤的总评分：`暴击率 * 2 + 暴击伤害 * 1`，也即1点暴击占2分，1点暴伤占1分。

### 伤害最大化

但是让总评分最大能达到伤害最大嘛？我们需要明白伤害和暴击暴伤的关系。记暴击率为`CRIT_Rate`，记暴击伤害为`CRIT_DMG`：

在一次攻击中，暴击的概率为`CRIT_Rate`，相较不考虑暴击暴伤 造成的伤害比例为`1 + CRIT_DMG`；未暴击的概率为`1 - CRIT_Rate`，相较不考虑暴击暴伤 造成的伤害比例为`1`。则一次攻击双暴加成的比例期望为：`CRIT_Rate * (1 + CRIT_DMG) + (1 - CRIT_Rate) * 1 = 1 + CRIT_Rate * CRIT_DMG`。

也就是说我们只需要让`1 + CRIT_Rate * CRIT_DMG`最大就能最大化暴击暴伤的伤害比例从而最大化伤害。但是这里要注意，我们是在什么条件下讨论这个问题？我们的资源是有限的，这里的资源是指武器和圣遗物双暴加成的总和。那么如何量化这个资源呢？我们可以根据上面谈到的暴击暴伤价值来用`CRIT_Rate * 2 + CRIT_DMG * 1`衡量资源的总数量。

更严格的，一位角色的总资源需要加入角色初始（init）的5%暴击和50%暴伤，也就是说，总资源的数值为角色初始就已经有的暴击暴伤评分加上角色身上穿的装备暴击暴伤总和（武器 Weapons 圣遗物 Artifacts），即 `CRIT_Rate * 2 + CRIT_DMG * 1 = (CRIT_Rate_WA + CRIT_Rate_init) * 2 + (CRIT_DMG_WA + CRIT_DMG_init) * 1 = CRIT_Rate_WA * 2 + CRIT_DMG_WA * 1 + 0.6`

## 演算

### 问题重述

条件：暴击暴伤总评分 `CRIT_Rate * 2 + CRIT_DMG * 1 = M`一定，式中`CRIT_Rate`为角色的面板暴击率，`CRIT_DMG`为角色的面板暴击伤害，`M`为账号能为一位角色提供的双暴资源总量，即能提供的暴击暴伤总评分。

问题：最大化伤害的比例期望 `E = 1 + CRIT_Rate * CRIT_DMG`

### 求解

由 `CRIT_Rate * 2 + CRIT_DMG * 1 = M`，得
`CRIT_DMG = M - CRIT_Rate * 2`
将上式代入`E = 1 + CRIT_Rate * CRIT_DMG`，得
`E = 1 + CRIT_Rate * (M - CRIT_Rate * 2)`
记 `x = CRIT_Rate`，得
`E = - 2x^2 + Mx + 1`
使用二次函数性质（或上式对x求导得极值点），得
当 `x = M/4` 时，`E` 取最大值 `E_max = M^2/8 + 1`
也即：
`CRIT_Rate = M/4` 且 `CRIT_DMG = M - CRIT_Rate * 2 = M/2` 时，我们用尽了账号能为一位角色提供的资源，并且使得这位角色的暴击暴伤加成比例最大化。

## 结果说明

### 对M的讨论

M = CRIT_Rate * 2 + CRIT_DMG * 1  = CRIT_Rate_WA * 2 + CRIT_DMG_WA * 1 + 0.6

先不考虑角色佩戴有暴击暴伤加成的武器，只考虑圣遗物的影响。

> 五星圣遗物头冠位置的主属性满级可以提供31.1%暴击或62.2%暴伤，圣遗物副词条初始如果有四词条且含有暴击和暴伤、在后期5次强化过程中都加点在双暴上，可以得到2.7%/3.1%/3.5%/3.9%暴击或5.4%/6.2%/7.0%/7.8%暴伤

主词条：一般后期都会带暴击头或暴伤头，提供的分数为`0.622`
副词条：五个位置的圣遗物最多可以得到34个有效双暴词条（5个位置，初始4词条，其中两条是双暴，强化过程5词条全部加在双暴上；减去头冠的一个词条）。这里我们考虑强化的平均值，一个词条平均的分数为`0.066`

确保暴击和暴伤的配比为`1:2`，横轴为圣遗物的双暴副词条数，纵轴分别为双暴加成比例、暴击率、暴击伤害。

考虑武器的加成也是类似的，只需要在M上再加上武器的加成分数即可：我们使用护摩之杖，给M加上双暴分数`0.662`。注意，在考虑武器之后，我们的暴击暴伤配比仍为`1:2`才能保证伤害最大化。

### 结果

![](./images/1.png)

![](./images/2.png)

可以看到，每个词条都能够在前一个词条的情况下稳定增幅约2.2%。在带暴击或暴伤武器的情况下，同等圣遗物时，伤害提高约25%（不严格 未考虑其他因素）。

这里的横轴为圣遗物副词条双暴数。一般玩家每个圣遗物能有三条（约每个圣遗物的评分为20，对应图中15条）已经很不错了，欧皇玩家则甚至可以达到每个圣遗物五条（约每个圣遗物的评分为33，对应图中25条）。可以看到，如果追求最佳配比，暴击是游戏中很难堆的一个属性，不会超过100%。

### 应用结论

* 在给一个角色的暴击暴伤资源总和一定的情况下，角色面板的暴击和暴伤配比为1:2时，双暴的伤害加成取得最大值（该结论可以经过简单而严格的数学论证得出）。
* 在圣遗物提供的双暴一定时，带暴击暴伤武器比不带的伤害高了约25%，推荐佩戴暴击暴伤武器提高伤害。
* 圣遗物的每一个双暴词条都能带来稳定的增幅，所以后期将重心放在有双暴词条圣遗物上是十分正确的。

# 附

## 其他

* 没水到六级所以没法发在硬核区

## MATLAB作图代码

```matlab
clear;close all;clc;

count_artifact = 0:34; % 圣遗物副词条数
M = 0.622 + 0.066 * count_artifact + 0.6; % 账号为一位角色提供的双暴资源（只考虑圣遗物）
E_max = M.^2/8 + 1;

figure(1);
subplot(2, 1, 1);
plot(count_artifact, E_max, "x-"); title("只考虑圣遗物的双暴加成"); ylim([0, 3]);
xlabel("圣遗物副词条数");
hold on
plot(count_artifact, M / 4, "x-");
plot(count_artifact, M / 2, "x-");
legend("双暴加成比例", "暴击率", "暴击伤害")

subplot(2, 1, 2);
E_max_previous = [0, E_max(1:end - 1), ];
improvement = (E_max - E_max_previous) ./ E_max_previous;
plot(count_artifact, improvement, "x-"); title("副词条数量的每次提升与前次相比的增幅"); ylim([0.017, 0.024]);
xlabel("圣遗物副词条数"); ylabel("增幅");

% - - -
count_artifact = 0:34;
M = 0.622 + 0.066 * count_artifact + 0.6 + 0.662; % 账号为一位角色提供的双暴资源，考虑武器为护摩之杖
E_max = M.^2/8 + 1;

figure(2)
subplot(2, 1, 1);
plot(count_artifact, E_max, "x-"); title("考虑武器和圣遗物的双暴加成"); ylim([0, 3]);
xlabel("圣遗物副词条数");
hold on
plot(count_artifact, M / 4, "x-");
plot(count_artifact, M / 2, "x-");
legend("双暴加成比例", "暴击率", "暴击伤害")

subplot(2, 1, 2);
E_max_previous = [0, E_max(1:end - 1), ];
improvement = (E_max - E_max_previous) ./ E_max_previous;
plot(count_artifact, improvement, "x-"); title("副词条数量的每次提升与前次相比的增幅"); ylim([0.017, 0.024]);
xlabel("圣遗物副词条数"); ylabel("增幅");
```
